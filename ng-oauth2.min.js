!function(){function t(){for(var t=[],e=0;e<arguments.length;e++){var n=String(arguments[e]||"").trim().replace(/^\/*|\/*$/g,"");""!=n&&t.push(n)}return t.join("/")}angular.module("ngOAuth2",[]),angular.module("ngOAuth2").provider("$oauth2",["$httpProvider",function(e){var u={authUrl:"http://localhost",grantType:"password",clientId:null,clientSecret:null,tokenUri:"/oauth/token",revokeUri:"/oauth/revoke"};this.setConfig=function(t){u=angular.extend({authUrl:"http://localhost",grantType:"password",clientId:null,clientSecret:null,tokenUri:"/oauth/token",revokeUri:"/oauth/revoke"},t||{})},this.setAuthorizationUrl=function(t){u.authUrl=t||"http://localhost"},this.setGrantType=function(t){u.grantType=t||"password"},this.setClientId=function(t){u.clientId=t||null},this.setClientSecret=function(t){u.clientSecret=t||null},this.setTokenUri=function(t){u.tokenUri=t||"/oauth/token"},this.setRevokeUri=function(t){u.revokeUri=t||"/oauth/revoke"},e.interceptors.push(["$q",function(t){return{request:function(t){var e=btoa("Canabis.OAuth2."+u.clientId);try{var n=JSON.parse(sessionStorage.getItem(e)||"{}");n&&n.access_token&&!t.headers.Authorization&&(t.headers.Authorization=[n.token_type,n.access_token].join(" "))}catch(t){o(t)}return t},requestError:function(e){return t.reject(e)},response:function(t){return t},responseError:function(e){return t.reject(e)}}}]),this.$get=["$rootScope","$http","$interval","$q","$timeout",function(e,i,c,s,a){var h=null,f=btoa("Canabis.OAuth2."+u.clientId);function l(t){!t&&r("[OAuth2] 리스너를 정지하고 있습니다..."),function(){for(var t=arguments[0],e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);"function"==typeof t&&t.apply(null,e)}(h),!t&&r("[OAuth2] 브라우저 스토리지에서 토큰정보를 삭제합니다..."),sessionStorage.removeItem(f),localStorage.removeItem(f)}function p(){return"Basic "+btoa([u.clientId,u.clientSecret].join(":"))}function d(t,n){var o=angular.extend(t.data,{remember:n});"number"==typeof o.expires_in&&o.expires_in>0&&r("[OAuth2] 리스너를 실행 중입니다..."),function(t,e){sessionStorage.setItem(f,JSON.stringify(t)),1==e&&localStroage.setItem(f,JSON.stringify(t))}(o,n),e.$broadcast("$oauth2.success",t)}function v(t){e.$broadcast("$oauth2.failed",t)}function g(e,n,c){var a=s.defer(),h=["grant_type=password","username="+e,"password="+n].join("&");return i({method:"POST",url:t(u.authUrl,u.tokenUri),headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:p()},data:h}).then(function(t){return r("[OAuth2] 접큰토큰이 발급되었습니다.",t.data),d(t,c),a.resolve(t)},function(t){return o("[OAuth2] 접근토큰을 발급받는데 실패하였습니다",t),v(),l(),a.reject(t)}),a.promise}return this.get=function(){var t=null;try{n("[OAuth2] 스토리지에서 접근토큰을 찾고 있습니다.",t=JSON.parse(sessionStorage.getItem(f)))}catch(t){}return t},this.request=function(){r("[OAuth2] 스토리지에 토큰정보가 있는지 찾아보고 있습니다...");try{var t=JSON.parse(localStroage.getItem(f));if(null!=t&&t.refresh_token)return r("[OAuth2] 스토리지에 있는 토큰정보를 찾았습니다...",t),__refresh();switch(r("[OAuth2] 스토리지에서 토큰을 찾지못하였습니다..."),l(!0),u.grantType){case"password":return g(arguments[0],arguments[1],arguments[2]);default:throw v(),"[OAuth2] 지원하지 않는 인증유형입니다."}}catch(t){switch(r("[OAuth2] 스토리지에서 토큰을 찾지못하였습니다..."),l(!0),u.grantType){case"password":return g(arguments[0],arguments[1],arguments[2]);default:throw"[OAuth2] 지원하지 않는 인증유형입니다."}}},this.revoke=function(){var e=s.defer();return i.get(t(u.authUrl,u.revokeUri)).then(function(t){return l(),e.resolve(t)},function(t){return l(),e.resolve(t)}),e.promise},this.refresh=function(){var e=s.defer(),r=null;try{if(null!=(r=JSON.parse(sessionStorage.getItem(f)))&&r.refresh_token){var c=["grant_type=refresh_token","refresh_token="+r.refresh_token].join("&");i({url:t(u.authUrl,u.tokenUri),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:p()},data:c,withCredential:!0}).then(function(t){return n("[OAuth2] 토큰이 갱신되었습니다.",t.data),d(t,r.remember),e.resolve(t)},function(t){return o("[OAuth2] 토큰갱신에 실패하였습니다.",t),l(),v(),e.reject(t)})}else v(),e.reject()}catch(t){v(),e.reject()}return e.promise},this.status=function(){return!0},this}]}]),angular.module("ngOAuth2").provider("$data",[function(){var e="http://localhost";this.setResourceUrl=function(t){e=t||"http://localhost"},this.$get=["$http","$q","$oauth2","$rootScope",function(n,r,o,u){function i(u){var i=o.get(),c=r.defer();return null==i?c.reject():n.head(t(e,u),{headers:{Authorization:[i.token_type,i.access_token].join(" ")}}).then(function(t){return c.resolve(t)},function(t){return c.reject(t)}),c.promise}return this.get=function(c,s){var a=r.defer();return i(c).then(function(r){n.get(t(e,c),s).then(function(t){return a.resolve(t)},function(t){return a.reject(t)})},function(r){o.status()?o.refresh().then(function(r){n.get(t(e,c),s).then(function(t){return a.resolve(t)},function(t){return a.reject(t)})},function(t){return a.reject(t)}):(u.$on("$oauth2.success",function(){n.get(t(e,c),s).then(function(t){return a.resolve(t)},function(t){return a.reject(t)})}),u.$on("$oauth2.failed",function(t,e){a.reject(e)}))}),a.promise},this.delete=function(c,s){var a=r.defer();return i(c).then(function(r){n.delete(t(e,c),s).then(function(t){return a.resolve(t)},function(t){return a.reject(t)})},function(r){o.status()?o.refresh().then(function(r){n.delete(t(e,c),s).then(function(t){return a.resolve(t)},function(t){return a.reject(t)})},function(t){return a.reject(t)}):(u.$on("$oauth2.success",function(){n.delete(t(e,c),s).then(function(t){return a.resolve(t)},function(t){return a.reject(t)})}),u.$on("$oauth2.failed",function(t,e){a.reject(e)}))}),a.promise},this.post=function(c,s,a){var h=r.defer();return i(c).then(function(r){n.post(t(e,c),s,a).then(function(t){return h.resolve(t)},function(t){return h.reject(t)})},function(r){o.status()?o.refresh().then(function(r){n.post(t(e,c),s,a).then(function(t){return h.resolve(t)},function(t){return h.reject(t)})},function(t){return h.reject(t)}):(u.$on("$oauth2.success",function(){n.post(t(e,c),s,a).then(function(t){return h.resolve(t)},function(t){return h.reject(t)})}),u.$on("$oauth2.failed",function(t,e){h.reject(e)}))}),h.promise},this.put=function(c,s,a){var h=r.defer();return i(c).then(function(r){n.put(t(e,c),s,a).then(function(t){return h.resolve(t)},function(t){return h.reject(t)})},function(r){o.status()?o.refresh().then(function(r){n.put(t(e,c),s,a).then(function(t){return h.resolve(t)},function(t){return h.reject(t)})},function(t){return h.reject(t)}):(u.$on("$oauth2.success",function(){n.put(t(e,c),s,a).then(function(t){return h.resolve(t)},function(t){return h.reject(t)})}),u.$on("$oauth2.failed",function(t,e){h.reject(e)}))}),h.promise},this}]}]);var e=!0;function n(){if(1==e){for(var t=["DEBUG"],n=0;n<arguments.length;n++)t.push(arguments[n]);console.log.apply(null,t)}}function r(){if(1==e){for(var t=["DEBUG"],n=0;n<arguments.length;n++)t.push(arguments[n]);console.info.apply(null,t)}}function o(){if(1==e){for(var t=["DEBUG"],n=0;n<arguments.length;n++)t.push(arguments[n]);console.error.apply(null,t)}}}();
